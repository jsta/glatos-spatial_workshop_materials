















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-02-18 18:18:21 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/dc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/dc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/dc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/dc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/dc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/dc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/dc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/dc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Data Carpentry - Working with Geospatial Data"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/dc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/dc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/dc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/dc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/dc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Working with Geospatial Data: Intro to Raster Data in R</title>
  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-vector-open-shapefile-in-r/index.html">Open and Plot Shapefiles in R</a></li>
            
            <li><a href="../02-vector-shapefile-attributes-in-r/index.html">Explore and Plot by Shapefile Attributes</a></li>
            
            <li><a href="../03-vector-csv-to-shapefile-in-r/index.html">Convert from .csv to a Shapefile in R</a></li>
            
            <li><a href="../04-raster-structure/index.html">Intro to Raster Data in R</a></li>
            
            <li><a href="../05-vector-raster-integration/index.html">Manipulate Raster Data in R</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	
	<li><a href="/edit//_episodes_rmd/04-raster-structure.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-vector-csv-to-shapefile-in-r/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Working with Geospatial Data</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-vector-raster-integration/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Intro to Raster Data in R</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is a raster dataset?</p>
</li>
	
	<li><p>How do I work with and plot raster data in R?</p>
</li>
	
	<li><p>How can I handle missing or bad data values for a raster?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the fundamental attributes of a raster dataset.</p>
</li>
	
	<li><p>Explore raster attributes and metadata using R.</p>
</li>
	
	<li><p>Import rasters into R using the <code class="highlighter-rouge">raster</code> package.</p>
</li>
	
	<li><p>Plot a raster file in R using the <code class="highlighter-rouge">ggplot2</code> package.</p>
</li>
	
	<li><p>Describe the difference between single- and multi-band rasters.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<blockquote class="prereq">
  <h2 id="things-youll-need-to-complete-this-episode">Things You’ll Need To Complete This Episode</h2>

  <p>See the <a href="">lesson homepage</a> for detailed information about the software,
data, and other prerequisites you will need to work through the examples in this episode.</p>
</blockquote>

<p>Starting with this episode, we will be moving from working with vector
data to working with raster data. In this episode, we will introduce the
fundamental principles, packages and metadata/raster attributes that are needed
to work with raster data in R. We will discuss some of the core metadata
elements that we need to understand to work with rasters in R, including CRS
and resolution. We will also explore missing and bad data values as stored in a
raster and how R handles these elements.</p>

<p>We will continue to work with the <code class="highlighter-rouge">dplyr</code> and <code class="highlighter-rouge">ggplot2</code> packages that were introduced
in the <a href="https://datacarpentry.org/r-intro-geospatial/">Introduction to R for Geospatial Data</a> lesson. We will use two additional packages in this episode to work with raster data - the
<code class="highlighter-rouge">raster</code> and <code class="highlighter-rouge">rgdal</code> packages. Make sure that you have these packages loaded.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="callout">
  <h2 id="introduce-the-data">Introduce the Data</h2>

  <p>If not already discussed, introduce the datasets that will be used in this
lesson. A brief introduction to the datasets can be found on the 
<a href="https://datacarpentry.org/geospatial-workshop/#data">Geospatial workshop homepage</a>.</p>

  <p>For more detailed information about the datasets, check
out the <a href="http://datacarpentry.org/geospatial-workshop/data/">Geospatial workshop data
page</a>.</p>
</blockquote>

<h2 id="view-raster-file-attributes">View Raster File Attributes</h2>

<p>We will be working with a series of GeoTIFF files in this lesson. The
GeoTIFF format contains a set of embedded tags with metadata about the raster
data. We can use the function <code class="highlighter-rouge">GDALinfo()</code> to get information about our raster
data before we read that data into R. It is ideal to do this before importing
your data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GDALinfo</span><span class="p">(</span><span class="s2">"data/erie_bathy.tif"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rows        623 
columns     1843 
bands       1 
lower left origin.x        245701 
lower left origin.y        4536578 
res.x       276 
res.y       370 
ysign       -1 
oblique.x   0 
oblique.y   0 
driver      GTiff 
projection  +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs 
file        data/erie_bathy.tif 
apparent band summary:
   GDType hasNoDataValue NoDataValue blockSize1 blockSize2
1 Float32           TRUE    -3.4e+38          1       1843
apparent band statistics:
       Bmin     Bmax Bmean Bsd
1 -62.47671 598.1871   NaN NaN
Metadata:
AREA_OR_POINT=Area 
</code></pre></div></div>

<p>If you wish to store this information in R, you can do the following:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erie_bathy_info</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">capture.output</span><span class="p">(</span><span class="w">
  </span><span class="n">GDALinfo</span><span class="p">(</span><span class="s2">"data/erie_bathy.tif"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Each line of text that was printed to the console is now stored as an element of
the character vector <code class="highlighter-rouge">erie_bathy_info</code>. We will be exploring this data throughout this 
episode. By the end of this episode, you will be able to explain and understand the output above.</p>

<h2 id="open-a-raster-in-r">Open a Raster in R</h2>

<p>Now that we’ve previewed the metadata for our GeoTIFF, let’s import this
raster dataset into R and explore its metadata more closely. We can use the <code class="highlighter-rouge">raster()</code> 
function to open a raster in R.</p>

<blockquote class="callout">
  <h2 id="data-tip---object-names">Data Tip - Object names</h2>
  <p>To improve code
readability, file and object names should be used that make it clear what is in
the file. The data for this episode were collected from Lake Erie so
we’ll use a naming convention of <code class="highlighter-rouge">datatype_HARV</code>.</p>
</blockquote>

<p>First we will load our raster file into R and view the data structure.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erie_bathy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="p">(</span><span class="s2">"data/erie_bathy.tif"</span><span class="p">)</span><span class="w">

</span><span class="n">erie_bathy</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class      : RasterLayer 
dimensions : 623, 1843, 1148189  (nrow, ncol, ncell)
resolution : 276, 370  (x, y)
extent     : 245701, 754369, 4536578, 4767088  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
source     : /home/jose/Documents/Science/Workshops/2020-02_glatos/glatos-spatial_workshop_materials/_episodes_rmd/data/erie_bathy.tif 
names      : erie_bathy 
values     : -62.47671, 598.1871  (min, max)
</code></pre></div></div>

<p>The information above includes a report of min and max values, but no other data
range statistics. Similar to other R data structures like vectors and data frame
columns, descriptive statistics for raster data can be retrieved like</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in .local(object, ...): summary is an estimate based on a sample of 1e+05 cells (8.71% of all cells)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        erie_bathy
Min.    -62.473782
1st Qu.   1.575743
Median   63.313280
3rd Qu. 219.961578
Max.    596.867676
NA's      0.000000
</code></pre></div></div>

<p>but note the warning - unless you force R to calculate these statistics using
every cell in the raster, it will take a random sample of 100,000 cells and
calculate from that instead. To force calculation on more, or even all values,
you can use the parameter <code class="highlighter-rouge">maxsamp</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">,</span><span class="w"> </span><span class="n">maxsamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncell</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>         erie_bathy
Min.      -62.47671
1st Qu.     1.49860
Median     63.22672
3rd Qu.   220.23468
Max.      598.18713
NA's    64779.00000
</code></pre></div></div>

<p>You may not see major differences in summary stats as <code class="highlighter-rouge">maxsamp</code> increases,
except with very large rasters.</p>

<p>To visualise this data in R using <code class="highlighter-rouge">ggplot2</code>, we need to convert it to a
dataframe. We learned about dataframes in <a href="https://datacarpentry.org/r-intro-geospatial/04-data-structures-part2/index.html">an earlier
lesson</a>.
The <code class="highlighter-rouge">raster</code> package has an built-in function for conversion to a plotable dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erie_bathy_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">,</span><span class="w"> </span><span class="n">xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now when we view the structure of our data, we will see a standard
dataframe format.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">erie_bathy_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1148189 obs. of  3 variables:
 $ x         : num  245839 246115 246391 246667 246943 ...
 $ y         : num  4766903 4766903 4766903 4766903 4766903 ...
 $ erie_bathy: num  NA NA NA NA NA NA NA NA NA NA ...
</code></pre></div></div>

<p>We can use <code class="highlighter-rouge">ggplot()</code> to plot this data. We will set the color scale to <code class="highlighter-rouge">scale_fill_viridis_c</code>
which is a color-blindness friendly color scale. We will also use the <code class="highlighter-rouge">coord_quickmap()</code> function to use an approximate Mercator projection for our plots. This approximation is suitable for small areas that are not too close to the poles. Other coordinate systems are available in ggplot2 if needed, you can learn about them at their help page <code class="highlighter-rouge">?coord_map</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_raster</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erie_bathy_df</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erie_bathy</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_viridis_c</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-04-ggplot-raster-1.png" title="Raster plot with ggplot2 using the viridis color scale" alt="Raster plot with ggplot2 using the viridis color scale" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="callout">
  <h2 id="plotting-tip">Plotting Tip</h2>

  <p>More information about the Viridis palette used above at
<a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">R Viridis package documentation</a>.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="plotting-tip-1">Plotting Tip</h2>
  <p>For faster, simpler plots, you can use the <code class="highlighter-rouge">plot</code> function from the <code class="highlighter-rouge">raster</code> package.</p>
  <blockquote class="solution">
    <h2 id="show-plot">Show plot</h2>
    <p>See <code class="highlighter-rouge">?plot</code> for more arguments to customize the plot</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-04-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<p>This map shows the elevation of our Lake Erie study area. From the
legend, we can see that the maximum elevation is ~600, but we can’t tell whether
this is 600 feet or 600 meters because the legend doesn’t show us the units. We
can look at the metadata of our object to see what the units are. Much of the
metadata that we’re interested in is part of the CRS. We introduced the
concept of a CRS in <a href="https://datacarpentry.org/organization-geospatial/03-crs">an earlier
lesson</a>.</p>

<p>Now we will see how features of the CRS appear in our data file and what
meanings they have.</p>

<h3 id="view-raster-coordinate-reference-system-crs-in-r">View Raster Coordinate Reference System (CRS) in R</h3>
<p>We can view the CRS string associated with our R object using the<code class="highlighter-rouge">crs()</code>
function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crs</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CRS arguments:
 +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs 
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge">Challenge</h2>
  <p>What units are our data in?</p>

  <blockquote class="solution">
    <h2 id="answers">Answers</h2>
    <p><code class="highlighter-rouge">+units=m</code> tells us that our data is in meters.</p>
  </blockquote>
</blockquote>

<h2 id="understanding-crs-in-proj4-format">Understanding CRS in Proj4 Format</h2>
<p>The CRS for our data is given to us by R in <code class="highlighter-rouge">proj4</code> format. Let’s break down
the pieces of <code class="highlighter-rouge">proj4</code> string. The string contains all of the individual CRS
elements that R or another GIS might need. Each element is specified with a
<code class="highlighter-rouge">+</code> sign, similar to how a <code class="highlighter-rouge">.csv</code> file is delimited or broken up by a <code class="highlighter-rouge">,</code>. After
each <code class="highlighter-rouge">+</code> we see the CRS element being defined. For example projection (<code class="highlighter-rouge">proj=</code>)
and zone (<code class="highlighter-rouge">zone=</code>).</p>

<h3 id="utm-proj4-string">UTM Proj4 String</h3>
<p>Our projection string for <code class="highlighter-rouge">erie_bathy</code> specifies the UTM projection as follows:</p>

<p><code class="highlighter-rouge">+proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></p>

<ul>
  <li><strong>proj=utm:</strong> the projection is UTM, UTM has several zones.</li>
  <li><strong>zone=17:</strong> the zone is 17</li>
  <li><strong>ellps=GRS80:</strong> the ellipsoid (how the earth’s  roundness is calculated) for
the data is GRS80</li>
  <li><strong>towgs84:</strong> transformations required to align to 0,0 reference coordinate system used in the projection</li>
  <li><strong>units=m:</strong> the units for the horizontal coordinates are in meters</li>
</ul>

<p>Note that the zone is unique to the UTM projection. Not all CRSs will have a
zone. Image source: Chrismurf at English Wikipedia, via <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#/media/File:Utm-zones-USA.svg">Wikimedia Commons</a> (CC-BY).</p>

<p><img src="../images/Utm-zones-USA.svg" alt="The UTM zones across the continental United States. From: https://upload.wikimedia.org/wikipedia/commons/8/8d/Utm-zones-USA.svg" /></p>

<h2 id="calculate-raster-min-and-max-values">Calculate Raster Min and Max Values</h2>

<p>It is useful to know the minimum or maximum values of a raster dataset. In this
case, given we are working with elevation data, these values represent the
min/max elevation range at our site.</p>

<p>Raster statistics are often calculated and embedded in a GeoTIFF for us. We
can view these values:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">minValue</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -62.47671
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maxValue</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 598.1871
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="data-tip---set-min-and-max-values">Data Tip - Set min and max values</h2>
  <p>If the minimum and maximum values haven’t already been
calculated, we can calculate them using the
<code class="highlighter-rouge">setMinMax()</code> function.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erie_bathy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setMinMax</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<p>We can see that the elevation at our site ranges from -62.4767075m to
598.1871338m.</p>

<h2 id="raster-bands">Raster Bands</h2>
<p>The Digital Surface Model object (<code class="highlighter-rouge">erie_bathy</code>) that we’ve been working with is a
single band raster. This means that there is only one dataset stored in the
raster: surface elevation in meters for one time period.</p>

<p><img src="../images/dc-spatial-raster/single_multi_raster.png" alt="Multi-band raster image" /></p>

<p>A raster dataset can contain one or more bands. We can use the <code class="highlighter-rouge">raster()</code>
function to import one single band from a single or multi-band raster. We can
view the number of bands in a raster using the <code class="highlighter-rouge">nlayers()</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nlayers</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<p>However, raster data can also be multi-band, meaning that one raster file
contains data for more than one variable or time period for each cell. By
default the <code class="highlighter-rouge">raster()</code> function only imports the first band in a raster
regardless of whether it has one or more bands. Jump to a later episode in
this series for information on working with multi-band rasters:
<a href="/05-raster-multi-band-in-r/">Work with Multi-band Rasters in R</a>.</p>

<h2 id="dealing-with-missing-data">Dealing with Missing Data</h2>

<p>Raster data often has a <code class="highlighter-rouge">NoDataValue</code> associated with it. This is a value
assigned to pixels where data is missing or no data were collected.</p>

<p>By default the shape of a raster is always rectangular. So if we have  a dataset
that has a shape that isn’t rectangular, some pixels at the edge of the raster
will have <code class="highlighter-rouge">NoDataValue</code>s. This can happen if the data were collected by an
airplane which only flew over some part of a defined region.</p>

<p>In the image below, no pixels are black meaning we have data for every raster “cell”.</p>

<p><img src="../fig/rmd-04-demonstrate-no-data-black-ggplot-1.png" title="plot of chunk demonstrate-no-data-black-ggplot" alt="plot of chunk demonstrate-no-data-black-ggplot" width="612" style="display: block; margin: auto;" /></p>

<p>If your raster has <code class="highlighter-rouge">NA</code> values but you aren’t sure where they are, you can deliberately plot them in a particular colour. This can be useful when checking a dataset’s coverage. For instance, sometimes data can be missing where a sensor could not ‘see’ its target data, and you may wish to locate that missing data and fill it in.</p>

<p>To highlight <code class="highlighter-rouge">NA</code> values in ggplot, alter the <code class="highlighter-rouge">scale_fill_*()</code> layer to contain a colour instruction for <code class="highlighter-rouge">NA</code> values, like <code class="highlighter-rouge">scale_fill_viridis_c(na.value = 'deeppink')</code></p>

<p><img src="../fig/rmd-04-napink-1.png" title="plot of chunk napink" alt="plot of chunk napink" width="612" style="display: block; margin: auto;" /></p>

<p>The value that is conventionally used to take note of missing data (the
<code class="highlighter-rouge">NoDataValue</code> value) varies by the raster data type. For floating-point rasters,
the figure <code class="highlighter-rouge">-3.4e+38</code> is a common default, and for integers, <code class="highlighter-rouge">-9999</code> is
common. Some disciplines have specific conventions that vary from these
common values.</p>

<p>In some cases, other <code class="highlighter-rouge">NA</code> values may be more appropriate. An <code class="highlighter-rouge">NA</code> value should
be a) outside the range of valid values, and b) a value that fits the data type
in use. For instance, if your data ranges continuously from -20 to 100, 0 is
not an acceptable <code class="highlighter-rouge">NA</code> value! Or, for categories that number 1-15, 0 might be
fine for <code class="highlighter-rouge">NA</code>, but using -.000003 will force you to save the GeoTIFF on disk
as a floating point raster, resulting in a bigger file.</p>

<p>If we are lucky, our GeoTIFF file has a tag that tells us what is the
<code class="highlighter-rouge">NoDataValue</code>. If we are less lucky, we can find that information in the
raster’s metadata. If a <code class="highlighter-rouge">NoDataValue</code> was stored in the GeoTIFF tag, when R
opens up the raster, it will assign each instance of the value to <code class="highlighter-rouge">NA</code>. Values
of <code class="highlighter-rouge">NA</code> will be ignored by R as demonstrated above.</p>

<blockquote class="callout">
  <h2 id="challenge-1">Challenge</h2>
  <p>Use the output from the <code class="highlighter-rouge">GDALinfo()</code> function to find out what <code class="highlighter-rouge">NoDataValue</code> is used for our <code class="highlighter-rouge">erie_bathy</code> dataset.</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GDALinfo</span><span class="p">(</span><span class="s2">"data//erie_bathy.tif"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rows        623 
columns     1843 
bands       1 
lower left origin.x        245701 
lower left origin.y        4536578 
res.x       276 
res.y       370 
ysign       -1 
oblique.x   0 
oblique.y   0 
driver      GTiff 
projection  +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs 
file        data//erie_bathy.tif 
apparent band summary:
   GDType hasNoDataValue NoDataValue blockSize1 blockSize2
1 Float32           TRUE    -3.4e+38          1       1843
apparent band statistics:
       Bmin     Bmax Bmean Bsd
1 -62.47671 598.1871   NaN NaN
Metadata:
AREA_OR_POINT=Area 
</code></pre></div>    </div>

    <p><code class="highlighter-rouge">NoDataValue</code> are encoded as -3.4e+38.</p>
  </blockquote>
</blockquote>

<h2 id="bad-data-values-in-rasters">Bad Data Values in Rasters</h2>

<p>Bad data values are different from <code class="highlighter-rouge">NoDataValue</code>s. Bad data values are values
that fall outside of the applicable range of a dataset.</p>

<p>Examples of Bad Data Values:</p>

<ul>
  <li>The normalized difference vegetation index (NDVI), which is a measure of
greenness, has a valid range of -1 to 1. Any value outside of that range would
be considered a “bad” or miscalculated value.</li>
  <li>Reflectance data in an image will often range from 0-1 or 0-10,000 depending
upon how the data are scaled. Thus a value greater than 1 or greater than 10,000
is likely caused by an error in either data collection or processing.</li>
</ul>

<h3 id="find-bad-data-values">Find Bad Data Values</h3>
<p>Sometimes a raster’s metadata will tell us the range of expected values for a
raster. Values outside of this range are suspect and we need to consider that
when we analyze the data. Sometimes, we need to use some common sense and
scientific insight as we examine the data - just as we would for field data to
identify questionable values.</p>

<p>Plotting data with appropriate highlighting can help reveal patterns in bad
values and may suggest a solution. Below, reclassification is used to highlight
elevation values less than 0m with a contrasting colour.</p>

<p><img src="../fig/rmd-04-demo-bad-data-highlighting-1.png" title="plot of chunk demo-bad-data-highlighting" alt="plot of chunk demo-bad-data-highlighting" width="612" style="display: block; margin: auto;" /></p>

<h2 id="create-a-histogram-of-raster-values">Create A Histogram of Raster Values</h2>

<p>We can explore the distribution of values contained within our raster using the
<code class="highlighter-rouge">geom_histogram()</code> function which produces a histogram. Histograms are often
useful in identifying outliers and bad data values in our raster data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erie_bathy_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre></div></div>

<div class="error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: Removed 64779 rows containing non-finite values (stat_bin).
</code></pre></div></div>

<p><img src="../fig/rmd-04-view-raster-histogram-1.png" title="plot of chunk view-raster-histogram" alt="plot of chunk view-raster-histogram" width="612" style="display: block; margin: auto;" /></p>

<p>Notice that a warning message is thrown when R creates the histogram.</p>

<p><code class="highlighter-rouge">stat_bin()</code> using <code class="highlighter-rouge">bins = 30</code>. Pick better value with <code class="highlighter-rouge">binwidth</code>.</p>

<p>This warning is caused by a default setting in <code class="highlighter-rouge">geom_histogram</code> enforcing that there are
30 bins for the data. We can define the number of bins we want in the histogram
by using the <code class="highlighter-rouge">bins</code> value in the <code class="highlighter-rouge">geom_histogram()</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erie_bathy_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">erie_bathy</span><span class="p">),</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: Removed 64779 rows containing non-finite values (stat_bin).
</code></pre></div></div>

<p><img src="../fig/rmd-04-view-raster-histogram2-1.png" title="plot of chunk view-raster-histogram2" alt="plot of chunk view-raster-histogram2" width="612" style="display: block; margin: auto;" /></p>

<p>Note that the shape of this histogram looks similar to the previous one that
was created using the default of 30 bins. The distribution of elevation values
for our Bathymetry data looks reasonable. It is likely there are
no bad data values in this particular raster.</p>

<blockquote class="callout">
  <h2 id="more-resources">More Resources</h2>
  <ul>
    <li><a href="http://cran.r-project.org/package=raster">Read more about the <code class="highlighter-rouge">raster</code> package in R.</a></li>
  </ul>
</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>The GeoTIFF file format includes metadata about the raster data.</p>
</li>
    
    <li><p>To plot raster data with the <code class="highlighter-rouge">ggplot2</code> package, we need to convert it to a dataframe.</p>
</li>
    
    <li><p>R stores CRS information in the Proj4 format.</p>
</li>
    
    <li><p>Be careful when dealing with missing or bad data values.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-vector-csv-to-shapefile-in-r/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../05-vector-raster-integration/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2020
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://datacarpentry.org">Data Carpentry</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/04-raster-structure.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:stachel2@msu.edu">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
